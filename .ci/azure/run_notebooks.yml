pr: none
trigger:
- master

pool:
  vmImage: Ubuntu-16.04

steps:

- script: |
    git submodule update --init
  displayName: 'Fetch submodules'

- script: |
    sudo chown -R $USER $CONDA
    . $CONDA/etc/profile.d/conda.sh
    conda env update --prefix ./env -f exoplanet/environment.yml -q --prune
    conda activate ./env
    python -m pip install -U -r requirements-notebooks.txt
    python -m pip install -e ./exoplanet
  displayName: 'Setup conda'

- script: |
    . $CONDA/etc/profile.d/conda.sh
    conda activate ./env
    export THEANO_FLAGS=base_compiledir=`pwd`/theano_cache
    cd docs
    python run_notebooks.py notebooks/rv.ipynb
